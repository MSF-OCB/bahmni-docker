#!/bin/sh

BACKUP_DIR="{{ bahmni_backup_dir }}/backups/"

# Delete backups older than 30 days
/bin/find ${BACKUP_DIR} -mtime +30 -exec rm -rf {} \;

# Delete spurious files not ending in .7z
/bin/find ${BACKUP_DIR} -mindepth 1 -maxdepth 1 -not -name "*.7z" -exec rm -rf {} \;

for ARCHIVE in $(/bin/find ${BACKUP_DIR} -mtime +10); do
  DAY="$(date -r ${ARCHIVE} +%w)"
  # Keep Wed and Sat (days 3 and 6)
  for i in 1 2 4 5 0; do
    if [[ ${DAY} -eq ${i} ]]; then
      rm ${ARCHIVE}
    fi
  done
done

