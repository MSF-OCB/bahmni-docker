#!/bin/bash

if [ "${BAHMNI_SERVER_MODE}" != "active" -o "${BAHMNI_BACKUP_PASSIVE}" != "yes" ]; then
  echo "Skipping backup, mode (${BAHMNI_SERVER_MODE}) is not equal to active or bahmni_backup_passive (${BAHMNI_BACKUP_PASSIVE}) is not equal to yes."
  exit 0
fi

BACKUP_DIR="{{ bahmni_backup_dir }}/backups"

rsync -e "ssh -p 2222 -i /root/.ssh/bahmni_key" -avz --omit-dir-times --delete ${BACKUP_DIR}/ root@bahmni-passive:${BACKUP_DIR}/

